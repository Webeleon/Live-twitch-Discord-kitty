import { Injectable } from '@nestjs/common';
import { Kitty } from './kitty.entity';
import * as sharp from 'sharp';

@Injectable()
export class KittyImageGenerator {
  async generate(kitty: Kitty): Promise<Buffer> {
    const svg = this.kittyToSvg(kitty);
    return sharp(Buffer.from(svg)).png().toBuffer();
  }

  kittyToSvg(kitty: Kitty): string {
    return `<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
 <g>
  <title>Layer 1</title>
  <path stroke-width="3" stroke="#000" id="svg_3" 
  d="m166.5185,192.96717c3.25207,-0.69144 26.87251,27.5126 27.31801,33.19592c0.65041,8.29887 15.61035,8.29887 19.51284,8.29887c3.90269,0 31.87112,17.98107 50.73354,37.34547c18.86263,19.36418 74.14907,1.38311 78.05155,0c3.90269,-1.38333 182.1205,-38.03691 230.25218,-12.44841c23.1163,12.28931 68.68075,-31.12891 74.63693,-121.37243c-2.4391,-60.1673 -53.32706,-62.42536 -63.90479,-44.08814c-7.80518,8.12601 -21.13898,5.70551 -17.8867,-9.16339c2.95722,-9.95691 22.76491,-40.63026 59.35168,-27.14446c31.01684,11.43277 48.95695,38.93095 55.61175,79.35862c4.39035,87.13912 -57.07534,151.45597 -57.07534,151.45597c0,0 4.87821,22.82228 11.70787,37.34547c6.82945,14.52319 8.78069,64.31685 7.80497,70.54094c-0.97552,6.22432 29.26946,40.45762 39.02588,41.49479c8.45559,4.14955 32.19643,80.91503 33.17195,97.51277c8.7809,4.66813 -0.97552,28.00899 -11.70766,31.12115c-10.73214,3.11216 -13.65911,-18.67273 -13.65911,-29.04637c0,-10.37364 -10.73214,-59.13014 -40.97712,-64.31685c-30.24498,-5.18693 -56.58727,-22.82228 -56.58727,-22.82228c0,0 -1.95145,10.37386 -5.85393,14.52341c0,0 9.75642,17.63512 9.75642,43.56934c-0.97552,11.41103 -16.58587,46.68172 -27.31801,49.79388c0,0 -17.56159,29.04637 -25.36677,29.04637c-7.80518,0 -21.46429,10.37364 -42.92837,-2.07477c0,0 3.90248,-25.93422 23.41553,-18.67273c0,0 45.85533,-37.34524 23.41532,-53.9432c0,0 -13.6589,-20.74728 -21.46408,-29.04637c-7.80518,-8.29887 -15.61035,-21.78467 -17.56159,-37.34524c0,0 -65.36817,-4.14955 -81.95425,-8.29909c-16.58587,-4.14932 -46.83085,6.22432 -46.83085,12.44841c0,6.22432 4.87821,65.35445 13.6589,76.76548c0,0 2.92697,14.52319 0,18.67273c-2.92697,4.14932 10.73214,38.38263 -15.61035,35.27047c-24.87891,4.66813 -37.07443,-16.07916 -7.80497,-22.82206c1.46338,-22.30347 -37.07464,-116.70408 -62.44141,-103.73708c-33.17195,5.18693 -21.95194,-25.41541 -54.63603,22.82228c-34.14767,42.53195 -92.68639,72.61571 -95.61315,91.28845c0,0 -17.56159,-4.14955 -21.46429,10.37364c0,0 -45.85533,6.22432 -42.92837,-2.07477c2.92697,-8.29887 5.36607,-25.41541 23.41553,-18.67251c0,0 40.97712,-17.11676 80.0028,-105.81186c0,0 -4.87821,-22.82206 1.95124,-41.49479c6.82966,-18.67251 -3.90248,-95.43799 -52.68478,-91.28845c0,0 -18.21201,6.91576 -29.26925,-24.89683c0,0 -4.55311,-6.22432 0,-12.44841c4.5529,-6.22432 15.61035,-15.9063 17.56159,-22.82206c1.95124,-6.91598 6.50435,-17.28962 31.2205,-26.97182c11.70787,-12.967 -1.30062,-38.72835 1.95145,-39.42002z" 
  fill="#${kitty.furColor}"/>
  <ellipse stroke-width="3" ry="9.5" rx="8" id="svg_4" cy="258.5" cx="160" stroke="#000" fill="#${kitty.eyeColor}"/>
 </g>
</svg>`;
  }
}
